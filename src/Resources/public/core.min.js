var AjaxRequest={themePath:Contao.script_url+'system/themes/'+Contao.theme+'/',toggleNavigation:function(el,id,url){el.blur();var item=$(id),parent=$(el).getParent('li');if(item){if(parent.hasClass('node-collapsed')){item.setStyle('display',null);parent.removeClass('node-collapsed').addClass('node-expanded');$(el).store('tip:title',Contao.lang.collapse);new Request.Contao({url:url}).post({'action':'toggleNavigation','id':id,'state':1,'REQUEST_TOKEN':Contao.request_token})}else{item.setStyle('display','none');parent.removeClass('node-expanded').addClass('node-collapsed');$(el).store('tip:title',Contao.lang.expand);new Request.Contao({url:url}).post({'action':'toggleNavigation','id':id,'state':0,'REQUEST_TOKEN':Contao.request_token})}
return!1}
return!1},toggleStructure:function(el,id,level,mode){el.blur();var item=$(id),image=$(el).getFirst('img');if(item){if(item.getStyle('display')=='none'){item.setStyle('display',null);image.src=AjaxRequest.themePath+'icons/folMinus.svg';$(el).store('tip:title',Contao.lang.collapse);new Request.Contao({field:el}).post({'action':'toggleStructure','id':id,'state':1,'REQUEST_TOKEN':Contao.request_token})}else{item.setStyle('display','none');image.src=AjaxRequest.themePath+'icons/folPlus.svg';$(el).store('tip:title',Contao.lang.expand);new Request.Contao({field:el}).post({'action':'toggleStructure','id':id,'state':0,'REQUEST_TOKEN':Contao.request_token})}
return!1}
new Request.Contao({field:el,evalScripts:!0,onRequest:AjaxRequest.displayBox(Contao.lang.loading+' …'),onSuccess:function(txt){var li=new Element('li',{'id':id,'class':'parent','styles':{'display':'inline'}});new Element('ul',{'class':'level_'+level,'html':txt}).inject(li,'bottom');if(mode==5){li.inject($(el).getParent('li'),'after')}else{var folder=!1,parent=$(el).getParent('li'),next;while(typeOf(parent)=='element'&&(next=parent.getNext('li'))){parent=next;if(parent.hasClass('tl_folder')){folder=!0;break}}
if(folder){li.inject(parent,'before')}else{li.inject(parent,'after')}}
li.getElements('a').each(function(el){el.href=el.href.replace(/&ref=[a-f0-9]+/,'&ref='+Contao.referer_id)});$(el).store('tip:title',Contao.lang.collapse);image.src=AjaxRequest.themePath+'icons/folMinus.svg';window.fireEvent('structure');AjaxRequest.hideBox();window.fireEvent('ajax_change')}}).post({'action':'loadStructure','id':id,'level':level,'state':1,'REQUEST_TOKEN':Contao.request_token});return!1},toggleFileManager:function(el,id,folder,level){el.blur();var item=$(id),image=$(el).getFirst('img');if(item){if(item.getStyle('display')=='none'){item.setStyle('display',null);image.src=AjaxRequest.themePath+'icons/folMinus.svg';$(el).store('tip:title',Contao.lang.collapse);new Request.Contao({field:el}).post({'action':'toggleFileManager','id':id,'state':1,'REQUEST_TOKEN':Contao.request_token})}else{item.setStyle('display','none');image.src=AjaxRequest.themePath+'icons/folPlus.svg';$(el).store('tip:title',Contao.lang.expand);new Request.Contao({field:el}).post({'action':'toggleFileManager','id':id,'state':0,'REQUEST_TOKEN':Contao.request_token})}
return!1}
new Request.Contao({field:el,evalScripts:!0,onRequest:AjaxRequest.displayBox(Contao.lang.loading+' …'),onSuccess:function(txt){var li=new Element('li',{'id':id,'class':'parent','styles':{'display':'inline'}});new Element('ul',{'class':'level_'+level,'html':txt}).inject(li,'bottom');li.inject($(el).getParent('li'),'after');li.getElements('a').each(function(el){el.href=el.href.replace(/&ref=[a-f0-9]+/,'&ref='+Contao.referer_id)});$(el).store('tip:title',Contao.lang.collapse);image.src=AjaxRequest.themePath+'icons/folMinus.svg';AjaxRequest.hideBox();window.fireEvent('ajax_change')}}).post({'action':'loadFileManager','id':id,'level':level,'folder':folder,'state':1,'REQUEST_TOKEN':Contao.request_token});return!1},togglePagetree:function(el,id,field,name,level){el.blur();Backend.getScrollOffset();var item=$(id),image=$(el).getFirst('img');if(item){if(item.getStyle('display')=='none'){item.setStyle('display',null);image.src=AjaxRequest.themePath+'icons/folMinus.svg';$(el).store('tip:title',Contao.lang.collapse);new Request.Contao({field:el}).post({'action':'togglePagetree','id':id,'state':1,'REQUEST_TOKEN':Contao.request_token})}else{item.setStyle('display','none');image.src=AjaxRequest.themePath+'icons/folPlus.svg';$(el).store('tip:title',Contao.lang.expand);new Request.Contao({field:el}).post({'action':'togglePagetree','id':id,'state':0,'REQUEST_TOKEN':Contao.request_token})}
return!1}
new Request.Contao({field:el,evalScripts:!0,onRequest:AjaxRequest.displayBox(Contao.lang.loading+' …'),onSuccess:function(txt){var li=new Element('li',{'id':id,'class':'parent','styles':{'display':'inline'}});new Element('ul',{'class':'level_'+level,'html':txt}).inject(li,'bottom');li.inject($(el).getParent('li'),'after');li.getElements('a').each(function(el){el.href=el.href.replace(/&ref=[a-f0-9]+/,'&ref='+Contao.referer_id)});$(el).store('tip:title',Contao.lang.collapse);image.src=AjaxRequest.themePath+'icons/folMinus.svg';AjaxRequest.hideBox();window.fireEvent('ajax_change')}}).post({'action':'loadPagetree','id':id,'level':level,'field':field,'name':name,'state':1,'REQUEST_TOKEN':Contao.request_token});return!1},toggleFiletree:function(el,id,folder,field,name,level){el.blur();Backend.getScrollOffset();var item=$(id),image=$(el).getFirst('img');if(item){if(item.getStyle('display')=='none'){item.setStyle('display',null);image.src=AjaxRequest.themePath+'icons/folMinus.svg';$(el).store('tip:title',Contao.lang.collapse);new Request.Contao({field:el}).post({'action':'toggleFiletree','id':id,'state':1,'REQUEST_TOKEN':Contao.request_token})}else{item.setStyle('display','none');image.src=AjaxRequest.themePath+'icons/folPlus.svg';$(el).store('tip:title',Contao.lang.expand);new Request.Contao({field:el}).post({'action':'toggleFiletree','id':id,'state':0,'REQUEST_TOKEN':Contao.request_token})}
return!1}
new Request.Contao({field:el,evalScripts:!0,onRequest:AjaxRequest.displayBox(Contao.lang.loading+' …'),onSuccess:function(txt){var li=new Element('li',{'id':id,'class':'parent','styles':{'display':'inline'}});new Element('ul',{'class':'level_'+level,'html':txt}).inject(li,'bottom');li.inject($(el).getParent('li'),'after');li.getElements('a').each(function(el){el.href=el.href.replace(/&ref=[a-f0-9]+/,'&ref='+Contao.referer_id)});$(el).store('tip:title',Contao.lang.collapse);image.src=AjaxRequest.themePath+'icons/folMinus.svg';AjaxRequest.hideBox();window.fireEvent('ajax_change')}}).post({'action':'loadFiletree','id':id,'folder':folder,'level':level,'field':field,'name':name,'state':1,'REQUEST_TOKEN':Contao.request_token});return!1},toggleSubpalette:function(el,id,field){el.blur();var item=$(id);if(item){if(!el.value){el.value=1;el.checked='checked';item.setStyle('display',null);item.getElements('[data-required]').each(function(el){el.set('required','').set('data-required',null)});new Request.Contao({field:el}).post({'action':'toggleSubpalette','id':id,'field':field,'state':1,'REQUEST_TOKEN':Contao.request_token})}else{el.value='';el.checked='';item.setStyle('display','none');item.getElements('[required]').each(function(el){el.set('required',null).set('data-required','')});new Request.Contao({field:el}).post({'action':'toggleSubpalette','id':id,'field':field,'state':0,'REQUEST_TOKEN':Contao.request_token})}
return}
new Request.Contao({field:el,evalScripts:!1,onRequest:AjaxRequest.displayBox(Contao.lang.loading+' …'),onSuccess:function(txt,json){var div=new Element('div',{'id':id,'class':'subpal cf','html':txt,'styles':{'display':'block'}}).inject($(el).getParent('div').getParent('div'),'after');if(json.javascript){document.write=function(str){var src='';str.replace(/<script src="([^"]+)"/i,function(all,match){src=match});src&&Asset.javascript(src,{onLoad:function(){Browser.exec(json.javascript)}})};Browser.exec(json.javascript)}
el.value=1;el.checked='checked';div.getElements('a').each(function(el){el.href=el.href.replace(/&ref=[a-f0-9]+/,'&ref='+Contao.referer_id)});AjaxRequest.hideBox();window.fireEvent('subpalette');window.fireEvent('ajax_change')}}).post({'action':'toggleSubpalette','id':id,'field':field,'load':1,'state':1,'REQUEST_TOKEN':Contao.request_token})},toggleVisibility:function(el,id,table){el.blur();var img=null,image=$(el).getFirst('img'),published=(image.get('data-state')==1),div=el.getParent('div'),index,next,icon,icond,pa,params;if(image.get('data-state')===null){published=(image.src.indexOf('invisible')==-1);window.console&&console.warn('Using a visibility toggle without a "data-state" attribute is deprecated. Please adjust your Contao DCA file.')}
if(div.hasClass('tl_right')){img=div.getPrevious('div').getElement('img')}else if(div.hasClass('tl_listing_container')){img=el.getParent('td').getPrevious('td').getFirst('div.list_icon');if(img===null){img=el.getParent('td').getPrevious('td').getElement('div.cte_type')}
if(img===null){img=el.getParent('tr').getFirst('td').getElement('div.list_icon_new')}}else if(next=div.getNext('div')){if(next.hasClass('cte_type')){img=next}
if(img===null){img=next.getFirst('div.list_icon')}}
if(img!==null){if(img.nodeName.toLowerCase()=='img'){if(img.getParent('ul.tl_listing').hasClass('tl_tree_xtnd')){icon=img.get('data-icon');icond=img.get('data-icon-disabled');if(icon===null){icon=img.src.replace(/(.*)\/([a-z0-9]+)_?\.(gif|png|jpe?g|svg)$/,'$1/$2.$3');window.console&&console.warn('Using a row icon without a "data-icon" attribute is deprecated. Please adjust your Contao DCA file.')}
if(icond===null){icond=img.src.replace(/(.*)\/([a-z0-9]+)_?\.(gif|png|jpe?g|svg)$/,'$1/$2_.$3');window.console&&console.warn('Using a row icon without a "data-icon-disabled" attribute is deprecated. Please adjust your Contao DCA file.')}
if(icon.indexOf('/')==-1){icon=AjaxRequest.themePath+(icon.match(/\.svg$/)?'icons/':'images/')+icon}
if(icond.indexOf('/')==-1){icond=AjaxRequest.themePath+(icond.match(/\.svg$/)?'icons/':'images/')+icond}
img.src=!published?icon:icond}else{pa=img.getParent('a');if(pa&&pa.href.indexOf('do=feRedirect')==-1){if(next=pa.getNext('a')){img=next.getFirst('img')}else{img=new Element('img')}}
icon=img.get('data-icon');icond=img.get('data-icon-disabled');if(icon===null){index=img.src.replace(/.*_([0-9])\.(gif|png|jpe?g|svg)/,'$1');icon=img.src.replace(/_[0-9]\.(gif|png|jpe?g|svg)/,((index.toInt()==1)?'':'_'+(index.toInt()-1))+'.$1').split(/[\\/]/).pop();window.console&&console.warn('Using a row icon without a "data-icon" attribute is deprecated. Please adjust your Contao DCA file.')}
if(icond===null){index=img.src.replace(/.*_([0-9])\.(gif|png|jpe?g|svg)/,'$1');icond=img.src.replace(/(_[0-9])?\.(gif|png|jpe?g|svg)/,((index==img.src)?'_1':'_'+(index.toInt()+1))+'.$2').split(/[\\/]/).pop();window.console&&console.warn('Using a row icon without a "data-icon-disabled" attribute is deprecated. Please adjust your Contao DCA file.')}
if(icon.indexOf('/')==-1){icon=AjaxRequest.themePath+(icon.match(/\.svg$/)?'icons/':'images/')+icon}
if(icond.indexOf('/')==-1){icond=AjaxRequest.themePath+(icond.match(/\.svg$/)?'icons/':'images/')+icond}
img.src=!published?icon:icond}}else if(img.hasClass('cte_type')){if(!published){img.addClass('published');img.removeClass('unpublished')}else{img.addClass('unpublished');img.removeClass('published')}}else{icon=img.get('data-icon');icond=img.get('data-icon-disabled');if(icon===null){icon=img.getStyle('background-image').replace(/(.*)\/([a-z0-9]+)_?\.(gif|png|jpe?g|svg)\);?$/,'$1/$2.$2');window.console&&console.warn('Using a row icon without a "data-icon" attribute is deprecated. Please adjust your Contao DCA file.')}
if(icond===null){icond=img.getStyle('background-image').replace(/(.*)\/([a-z0-9]+)_?\.(gif|png|jpe?g|svg)\);?$/,'$1/$2_.$3');window.console&&console.warn('Using a row icon without a "data-icon-disabled" attribute is deprecated. Please adjust your Contao DCA file.')}
if(icon.indexOf('/')==-1){icon=AjaxRequest.themePath+(icon.match(/\.svg$/)?'icons/':'images/')+icon}
if(icond.indexOf('/')==-1){icond=AjaxRequest.themePath+(icond.match(/\.svg$/)?'icons/':'images/')+icond}
img.setStyle('background-image','url('+(!published?icon:icond)+')')}}
if(table=='tl_style'){div.getParent('div').getElement('pre').toggleClass('disabled')}
if(!published){image.src=AjaxRequest.themePath+'icons/visible.svg';image.set('data-state',1);params={'state':1,'rt':Contao.request_token};params[$(el).get('data-tid')||'tid']=id;new Request.Contao({'url':window.location.href,'followRedirects':!1}).get(params)}else{image.src=AjaxRequest.themePath+'icons/invisible.svg';image.set('data-state',0);params={'state':0,'rt':Contao.request_token};params[$(el).get('data-tid')||'tid']=id;new Request.Contao({'url':window.location.href,'followRedirects':!1}).get(params)}
return!1},toggleFeatured:function(el,id){el.blur();var image=$(el).getFirst('img'),featured=(image.get('data-state')==1);if(image.get('data-state')===null){featured=(image.src.indexOf('featured_')==-1);window.console&&console.warn('Using a featured toggle without a "data-state" attribute is deprecated. Please adjust your Contao DCA file.')}
if(!featured){image.src=AjaxRequest.themePath+'icons/featured.svg';image.set('data-state',1);new Request.Contao().post({'action':'toggleFeatured','id':id,'state':1,'REQUEST_TOKEN':Contao.request_token})}else{image.src=AjaxRequest.themePath+'icons/featured_.svg';image.set('data-state',0);new Request.Contao().post({'action':'toggleFeatured','id':id,'state':0,'REQUEST_TOKEN':Contao.request_token})}
return!1},toggleFieldset:function(el,id,table){el.blur();var fs=$('pal_'+id);if(fs.hasClass('collapsed')){fs.removeClass('collapsed');new Request.Contao().post({'action':'toggleFieldset','id':id,'table':table,'state':1,'REQUEST_TOKEN':Contao.request_token})}else{var form=fs.getParent('form'),inp=fs.getElements('[required]'),collapse=!0;for(var i=0;i<inp.length;i++){if(!inp[i].get('value')){collapse=!1;break}}
if(!collapse){if(typeof(form.checkValidity)=='function')form.getElement('button[type="submit"]').click()}else{fs.addClass('collapsed');new Request.Contao().post({'action':'toggleFieldset','id':id,'table':table,'state':0,'REQUEST_TOKEN':Contao.request_token})}}
return!1},toggleCheckboxGroup:function(el,id){el.blur();var item=$(id),image=$(el).getFirst('img');if(item){if(item.getStyle('display')=='none'){item.setStyle('display',null);image.src=AjaxRequest.themePath+'icons/folMinus.svg';new Request.Contao().post({'action':'toggleCheckboxGroup','id':id,'state':1,'REQUEST_TOKEN':Contao.request_token})}else{item.setStyle('display','none');image.src=AjaxRequest.themePath+'icons/folPlus.svg';new Request.Contao().post({'action':'toggleCheckboxGroup','id':id,'state':0,'REQUEST_TOKEN':Contao.request_token})}
return!0}
return!1},displayBox:function(message){var box=$('tl_ajaxBox'),overlay=$('tl_ajaxOverlay'),scroll=window.getScroll();if(overlay===null){overlay=new Element('div',{'id':'tl_ajaxOverlay'}).inject($(document.body),'bottom')}
overlay.set({'styles':{'display':'block','top':scroll.y+'px'}});if(box===null){box=new Element('div',{'id':'tl_ajaxBox'}).inject($(document.body),'bottom')}
box.set({'html':message,'styles':{'display':'block','top':(scroll.y+100)+'px'}})},hideBox:function(){var box=$('tl_ajaxBox'),overlay=$('tl_ajaxOverlay');if(overlay){overlay.setStyle('display','none')}
if(box){box.setStyle('display','none')}}};var Backend={currentId:null,xMousePosition:0,yMousePosition:0,popupWindow:null,themePath:Contao.script_url+'system/themes/'+Contao.theme+'/',getMousePosition:function(event){Backend.xMousePosition=event.client.x;Backend.yMousePosition=event.client.y},openWindow:function(el,width,height){el.blur();width=Browser.ie?(width+40):(width+17);height=Browser.ie?(height+30):(height+17);Backend.popupWindow=window.open(el.href,'','width='+width+',height='+height+',modal=yes,left=100,top=50,location=no,menubar=no,resizable=yes,scrollbars=yes,status=no,toolbar=no')},openModalWindow:function(width,title,content){new SimpleModal({'width':width,'hideFooter':!0,'draggable':!1,'overlayOpacity':.7,'onShow':function(){document.body.setStyle('overflow','hidden')},'onHide':function(){document.body.setStyle('overflow','auto')}}).show({'title':title,'contents':content})},openModalImage:function(options){var opt=options||{},maxWidth=(window.getSize().x-20).toInt();if(!opt.width||opt.width>maxWidth)opt.width=Math.min(maxWidth,900);var M=new SimpleModal({'width':opt.width,'hideFooter':!0,'draggable':!1,'overlayOpacity':.7,'onShow':function(){document.body.setStyle('overflow','hidden')},'onHide':function(){document.body.setStyle('overflow','auto')}});M.show({'title':opt.title,'contents':'<img src="'+opt.url+'" alt="">'})},openModalIframe:function(options){var opt=options||{},maxWidth=(window.getSize().x-20).toInt(),maxHeight=(window.getSize().y-137).toInt();if(!opt.width||opt.width>maxWidth)opt.width=Math.min(maxWidth,900);if(!opt.height||opt.height>maxHeight)opt.height=maxHeight;var M=new SimpleModal({'width':opt.width,'hideFooter':!0,'draggable':!1,'overlayOpacity':.7,'onShow':function(){document.body.setStyle('overflow','hidden')},'onHide':function(){document.body.setStyle('overflow','auto')}});M.show({'title':opt.title,'contents':'<iframe src="'+opt.url+'" width="100%" height="'+opt.height+'" frameborder="0"></iframe>'})},openModalSelector:function(options){var opt=options||{},maxWidth=(window.getSize().x-20).toInt(),maxHeight=(window.getSize().y-192).toInt();if(!opt.id)opt.id='tl_select';if(!opt.width||opt.width>maxWidth)opt.width=Math.min(maxWidth,900);if(!opt.height||opt.height>maxHeight)opt.height=maxHeight;var M=new SimpleModal({'width':opt.width,'btn_ok':Contao.lang.close,'draggable':!1,'overlayOpacity':.7,'onShow':function(){document.body.setStyle('overflow','hidden')},'onHide':function(){document.body.setStyle('overflow','auto')}});M.addButton(Contao.lang.close,'btn',function(){if(this.buttons[0].hasClass('btn-disabled')){return}
this.hide()});M.addButton(Contao.lang.apply,'btn primary',function(){if(this.buttons[1].hasClass('btn-disabled')){return}
var frm=window.frames['simple-modal-iframe'],val=[],ul,inp,field,act,it,i;if(frm===undefined){alert('Could not find the SimpleModal frame');return}
ul=frm.document.getElementById(opt.id);inp=ul.getElementsByTagName('input');for(i=0;i<inp.length;i++){if(inp[i].checked&&!inp[i].id.match(/^(check_all_|reset_)/)){val.push(inp[i].get('value'))}}
if(opt.callback){opt.callback(ul.get('data-table'),val)}else if(opt.tag&&(field=$(opt.tag))){window.console&&console.warn('Using the modal selector without a callback function is deprecated. Please adjust your Contao DCA file.');field.value=val.join(',');if(it=ul.get('data-inserttag')){field.value='{{'+it+'::'+field.value+'}}'}
opt.self.set('href',opt.self.get('href').replace(/&value=[^&]*/,'&value='+val.join(',')))}else if(opt.id&&(field=$('ctrl_'+opt.id))&&(act=ul.get('data-callback'))){window.console&&console.warn('Using the modal selector without a callback function is deprecated. Please adjust your Contao DCA file.');field.value=val.join("\t");new Request.Contao({field:field,evalScripts:!1,onRequest:AjaxRequest.displayBox(Contao.lang.loading+' …'),onSuccess:function(txt,json){$('ctrl_'+opt.id).getParent('div').set('html',json.content);json.javascript&&Browser.exec(json.javascript);AjaxRequest.hideBox();window.fireEvent('ajax_change')}}).post({'action':act,'name':opt.id,'value':field.value,'REQUEST_TOKEN':Contao.request_token})}
this.hide()});M.show({'title':opt.title,'contents':'<iframe src="'+opt.url+'" name="simple-modal-iframe" width="100%" height="'+opt.height+'" frameborder="0"></iframe>','model':'modal'})},openModalBrowser:function(field_name,url,type,win){Backend.openModalSelector({'id':'tl_listing','title':win.document.getElement('div.mce-title').get('text'),'url':document.location.pathname+'/picker?context='+(type=='file'?'link':'file')+'&amp;extras[fieldType]=radio&amp;extras[filesOnly]=true&amp;value='+url+'&amp;popup=1','callback':function(table,value){win.document.getElementById(field_name).value=value.join(',')}})},getScrollOffset:function(){document.cookie="BE_PAGE_OFFSET="+window.getScroll().y+"; path="+(Contao.path||'/')},autoSubmit:function(el){Backend.getScrollOffset();var hidden=new Element('input',{'type':'hidden','name':'SUBMIT_TYPE','value':'auto'});var form=$(el)||el;hidden.inject(form,'bottom');form.submit()},vScrollTo:function(offset){window.addEvent('load',function(){window.scrollTo(null,parseInt(offset))})},limitPreviewHeight:function(){var hgt=0;$$('div.limit_height').each(function(div){var parent=div.getParent('.tl_content'),toggler,button,size,style;if(parent&&(parent.hasClass('wrapper_start')||parent.hasClass('wrapper_stop')))return;if(hgt===0){hgt=div.className.replace(/[^0-9]*/,'').toInt()}
if(!hgt)return;toggler=new Element('div',{'class':'limit_toggler'});button=new Element('button',{'html':'<span>...</span>','class':'unselectable','data-state':0}).inject(toggler);size=div.getCoordinates();div.setStyle('height',hgt);if(size.height<=hgt){return}
button.addEvent('click',function(){style=toggler.getPrevious('div').getStyle('height').toInt();toggler.getPrevious('div').setStyle('height',((style>hgt)?hgt:''));button.set('data-state',button.get('data-state')?0:1)});toggler.inject(div,'after')})},toggleCheckboxes:function(el,id){var items=$$('input'),status=$(el).checked?'checked':'';for(var i=0;i<items.length;i++){if(items[i].type.toLowerCase()!='checkbox'){continue}
if(id!==undefined&&id!=items[i].id.substr(0,id.length)){continue}
items[i].checked=status}},toggleCheckboxGroup:function(el,id){var cls=$(el).className,status=$(el).checked?'checked':'';if(cls=='tl_checkbox'){var cbx=$(id)?$$('#'+id+' .tl_checkbox'):$(el).getParent('fieldset').getElements('.tl_checkbox');cbx.each(function(checkbox){checkbox.checked=status})}else if(cls=='tl_tree_checkbox'){$$('#'+id+' .parent .tl_tree_checkbox').each(function(checkbox){checkbox.checked=status})}
Backend.getScrollOffset()},toggleCheckboxElements:function(el,cls){var status=$(el).checked?'checked':'';$$('.'+cls).each(function(checkbox){if(checkbox.hasClass('tl_checkbox')){checkbox.checked=status}});Backend.getScrollOffset()},toggleWrap:function(id){var textarea=$(id),status=(textarea.getProperty('wrap')=='off')?'soft':'off';textarea.setProperty('wrap',status)},toggleUnchanged:function(){$$('#result-list .tl_confirm').each(function(el){el.toggleClass('hidden')})},blink:function(){},addColorPicker:function(){return!0},collapsePalettes:function(){$$('fieldset.hide').each(function(el){el.addClass('collapsed')});$$('label.error, label.mandatory').each(function(el){var fs=el.getParent('fieldset');fs&&fs.removeClass('collapsed')})},addInteractiveHelp:function(){new Tips.Contao('p.tl_tip',{offset:{x:9,y:23},text:function(e){return e.get('html')}});new Tips.Contao($('home'),{offset:{x:15,y:42}});new Tips.Contao($$('#tmenu a[title]').filter(function(i){return i.title!=''}),{offset:{x:-12,y:42},windowPadding:{x:200,y:0}});new Tips.Contao($$('#tmenu button[title]').filter(function(i){return i.title!=''}),{offset:{x:-14,y:42}});new Tips.Contao($$('a[title][class^="group-"]').filter(function(i){return i.title!=''}),{offset:{x:3,y:27}});new Tips.Contao($$('a[title].navigation').filter(function(i){return i.title!=''}),{offset:{x:34,y:32}});$$('img[title]').filter(function(i){return i.title!=''}).each(function(el){new Tips.Contao(el,{offset:{x:0,y:((el.get('class')=='gimage')?60:30)}})});['a[title]','input[title]','button[title]','time[title]'].each(function(el){new Tips.Contao($$(el).filter(function(i){return i.title!=''}),{offset:{x:0,y:((el=='time[title]')?26:30)}})})},makeParentViewSortable:function(ul){var ds=new Scroller(document.getElement('body'),{onChange:function(x,y){this.element.scrollTo(this.element.getScroll().x,y)}});var list=new Sortables(ul,{constrain:!0,opacity:0.6,onStart:function(){ds.start()},onComplete:function(){ds.stop()},onSort:function(el){var ul=el.getParent('ul'),wrapLevel=0,divs,i;if(!ul)return;divs=ul.getChildren('li > div:first-child');if(!divs)return;for(i=0;i<divs.length;i++){if(divs[i].hasClass('wrapper_stop')&&wrapLevel>0){wrapLevel--}
divs[i].className=divs[i].className.replace(/(^|\s)indent[^\s]*/g,'');if(wrapLevel>0){divs[i].addClass('indent').addClass('indent_'+wrapLevel)}
if(divs[i].hasClass('wrapper_start')){wrapLevel++}
divs[i].removeClass('indent_first');divs[i].removeClass('indent_last');if(divs[i-1]&&divs[i-1].hasClass('wrapper_start')){divs[i].addClass('indent_first')}
if(divs[i+1]&&divs[i+1].hasClass('wrapper_stop')){divs[i].addClass('indent_last')}}},handle:'.drag-handle'});list.active=!1;list.addEvent('start',function(){list.active=!0});list.addEvent('complete',function(el){if(!list.active)return;var id,pid,req,href;if(el.getPrevious('li')){id=el.get('id').replace(/li_/,'');pid=el.getPrevious('li').get('id').replace(/li_/,'');req=window.location.search.replace(/id=[0-9]*/,'id='+id)+'&act=cut&mode=1&pid='+pid;href=window.location.href.replace(/\?.*$/,'');new Request.Contao({'url':href+req,'followRedirects':!1}).get()}else if(el.getParent('ul')){id=el.get('id').replace(/li_/,'');pid=el.getParent('ul').get('id').replace(/ul_/,'');req=window.location.search.replace(/id=[0-9]*/,'id='+id)+'&act=cut&mode=2&pid='+pid;href=window.location.href.replace(/\?.*$/,'');new Request.Contao({'url':href+req,'followRedirects':!1}).get()}})},makeMultiSrcSortable:function(id,oid,val){var list=new Sortables($(id),{constrain:!0,opacity:0.6}).addEvent('complete',function(){var els=[],lis=$(id).getChildren('li'),i;for(i=0;i<lis.length;i++){els.push(lis[i].get('data-id'))}
$(oid).value=els.join(',')});$(id).getElements('.gimage').each(function(el){if(el.hasClass('removable')){new Element('button',{type:'button',html:'&times;','class':'tl_red'}).addEvent('click',function(){var li=el.getParent('li'),did=li.get('data-id');$(val).value=$(val).value.split(',').filter(function(j){return j!=did}).join(',');$(oid).value=$(oid).value.split(',').filter(function(j){return j!=did}).join(',');li.dispose()}).inject(el,'after')}else{new Element('button',{type:'button',html:'&times',disabled:!0}).inject(el,'after')}});list.fireEvent("complete")},enableFileTreeDragAndDrop:function(ul,options){var ds=new Scroller(document.getElement('body'),{onChange:function(x,y){this.element.scrollTo(this.element.getScroll().x,y)}});ul.addEvent('mousedown',function(event){var dragElement=(event.target.hasClass('tl_file')||event.target.hasClass('tl_folder'))?event.target:event.target.getParent('.tl_file,.tl_folder');if(!dragElement||event.target.match('a')||event.target.getParent('a')){return}
ds.start();var cloneBase=(dragElement.getElements('.tl_left')[0]||dragElement),clone=cloneBase.clone(!0).inject(ul).setPosition(cloneBase.getPosition(cloneBase.getOffsetParent())).setStyle('opacity',0.7),currentHover,currentHoverTime;var move=new Drag.Move(clone,{droppables:$$([ul]).append(ul.getElements('.tl_folder,li.parent,.tl_folder_top')),modifiers:{x:'left',y:'top',},onEnter:function(element,droppable){droppable=fixDroppable(droppable);droppable.addClass('tl_folder_dropping');if(droppable.hasClass('tl_folder')&&currentHover!==droppable){currentHover=droppable;currentHoverTime=new Date().getTime();var expandLink=droppable.getElement('img[src$="/icons/folPlus.svg"]');expandLink=expandLink&&expandLink.getParent('a');if(expandLink){setTimeout(function(){if(currentHover===droppable&&currentHoverTime+900<new Date().getTime()){var event=document.createEvent('HTMLEvents');event.initEvent('click',!0,!0);expandLink.dispatchEvent(event);currentHover=undefined;currentHoverTime=undefined;window.addEvent('ajax_change',function onAjax(){if(move&&move.droppables&&ul&&ul.getElements){move.droppables=$$([ul]).append(ul.getElements('.tl_folder,li.parent'))}
window.removeEvent('ajax_change',onAjax)})}},1000)}}},onDrop:function(element,droppable){currentHover=undefined;currentHoverTime=undefined;ds.stop();clone.destroy();ul.getElements('.tl_folder_dropping').removeClass('tl_folder_dropping');droppable=fixDroppable(droppable);if(!droppable){return}
var id=dragElement.get('data-id'),pid=droppable.get('data-id');if(id&&pid&&((pid+'/').indexOf(id+'/')===0||pid+'/'===id.replace(/[^/]+$/,''))){return}
Backend.getScrollOffset();var url=options.url+'&id='+encodeURIComponent(id);if(pid){url+='&pid='+encodeURIComponent(pid)}
document.location.href=url},onLeave:function(element,droppable){droppable=fixDroppable(droppable);droppable.removeClass('tl_folder_dropping');currentHover=undefined;currentHoverTime=undefined}});move.start(event)});function fixDroppable(droppable){if(droppable&&droppable.hasClass('parent')&&droppable.getPrevious('.tl_folder')){return droppable.getPrevious('.tl_folder')}
return droppable}},listWizard:function(id){var ul=$(id),makeSortable=function(ul){new Sortables(ul,{constrain:!0,opacity:0.6,handle:'.drag-handle'})},addEventsTo=function(li){var command,clone,input,previous,next;li.getElements('button').each(function(bt){if(bt.hasEvent('click'))return;command=bt.getProperty('data-command');switch(command){case 'copy':bt.addEvent('click',function(){Backend.getScrollOffset();clone=li.clone(!0).inject(li,'before');if(input=li.getFirst('input')){clone.getFirst('input').value=input.value}
addEventsTo(clone)});break;case 'delete':bt.addEvent('click',function(){Backend.getScrollOffset();if(ul.getChildren().length>1){li.destroy()}});break;case null:bt.addEvent('keydown',function(e){if(e.event.keyCode==38){e.preventDefault();if(previous=li.getPrevious('li')){li.inject(previous,'before')}else{li.inject(ul,'bottom')}
bt.focus()}else if(e.event.keyCode==40){e.preventDefault();if(next=li.getNext('li')){li.inject(next,'after')}else{li.inject(ul.getFirst('li'),'before')}
bt.focus()}});break}})};makeSortable(ul);ul.getChildren().each(function(li){addEventsTo(li)})},tableWizard:function(id){var table=$(id),thead=table.getElement('thead'),tbody=table.getElement('tbody'),makeSortable=function(tbody){var rows=tbody.getChildren(),textarea,childs,i,j;for(i=0;i<rows.length;i++){childs=rows[i].getChildren();for(j=0;j<childs.length;j++){if(textarea=childs[j].getFirst('textarea')){textarea.name=textarea.name.replace(/\[[0-9]+][[0-9]+]/g,'['+i+']['+j+']')}}}
new Sortables(tbody,{constrain:!0,opacity:0.6,handle:'.drag-handle',onComplete:function(){makeSortable(tbody)}})},addEventsTo=function(tr){var head=thead.getFirst('tr'),command,textarea,current,next,ntr,childs,index,i;tr.getElements('button').each(function(bt){if(bt.hasEvent('click'))return;command=bt.getProperty('data-command');switch(command){case 'rcopy':bt.addEvent('click',function(){Backend.getScrollOffset();ntr=new Element('tr');childs=tr.getChildren();for(i=0;i<childs.length;i++){next=childs[i].clone(!0).inject(ntr,'bottom');if(textarea=childs[i].getFirst('textarea')){next.getFirst('textarea').value=textarea.value}}
ntr.inject(tr,'after');addEventsTo(ntr);makeSortable(tbody)});break;case 'rdelete':bt.addEvent('click',function(){Backend.getScrollOffset();if(tbody.getChildren().length>1){tr.destroy()}
makeSortable(tbody)});break;case 'ccopy':bt.addEvent('click',function(){Backend.getScrollOffset();index=getIndex(bt);childs=tbody.getChildren();for(i=0;i<childs.length;i++){current=childs[i].getChildren()[index];next=current.clone(!0).inject(current,'after');if(textarea=current.getFirst('textarea')){next.getFirst('textarea').value=textarea.value}
addEventsTo(next)}
next=head.getFirst('td').clone(!0).inject(head.getLast('td'),'before');addEventsTo(next);makeSortable(tbody)});break;case 'cmovel':bt.addEvent('click',function(){Backend.getScrollOffset();index=getIndex(bt);childs=tbody.getChildren();if(index>0){for(i=0;i<childs.length;i++){current=childs[i].getChildren()[index];current.inject(current.getPrevious(),'before')}}else{for(i=0;i<childs.length;i++){current=childs[i].getChildren()[index];current.inject(childs[i].getLast(),'before')}}
makeSortable(tbody)});break;case 'cmover':bt.addEvent('click',function(){Backend.getScrollOffset();index=getIndex(bt);childs=tbody.getChildren();if(index<(tr.getChildren().length-2)){for(i=0;i<childs.length;i++){current=childs[i].getChildren()[index];current.inject(current.getNext(),'after')}}else{for(i=0;i<childs.length;i++){current=childs[i].getChildren()[index];current.inject(childs[i].getFirst(),'before')}}
makeSortable(tbody)});break;case 'cdelete':bt.addEvent('click',function(){Backend.getScrollOffset();index=getIndex(bt);childs=tbody.getChildren();if(tr.getChildren().length>2){for(i=0;i<childs.length;i++){childs[i].getChildren()[index].destroy()}
head.getFirst('td').destroy()}
makeSortable(tbody)});break;case null:bt.addEvent('keydown',function(e){if(e.event.keyCode==38){e.preventDefault();if(ntr=tr.getPrevious('tr')){tr.inject(ntr,'before')}else{tr.inject(tbody,'bottom')}
bt.focus();makeSortable(tbody)}else if(e.event.keyCode==40){e.preventDefault();if(ntr=tr.getNext('tr')){tr.inject(ntr,'after')}else{tr.inject(tbody,'top')}
bt.focus();makeSortable(tbody)}});break}})},getIndex=function(bt){var td=$(bt).getParent('td'),tr=td.getParent('tr'),cols=tr.getChildren(),index=0,i;for(i=0;i<cols.length;i++){if(cols[i]==td){break}
index++}
return index};makeSortable(tbody);thead.getChildren().each(function(tr){addEventsTo(tr)});tbody.getChildren().each(function(tr){addEventsTo(tr)});Backend.tableWizardResize()},tableWizardResize:function(factor){var size=Cookie.read('BE_CELL_SIZE');if(factor!==undefined){size='';$$('.tl_tablewizard textarea').each(function(el){el.setStyle('width',(el.getStyle('width').toInt()*factor).round().limit(142,284));el.setStyle('height',(el.getStyle('height').toInt()*factor).round().limit(66,132));if(size==''){size=el.getStyle('width')+'|'+el.getStyle('height')}});Cookie.write('BE_CELL_SIZE',size,{path:Contao.path})}else if(size!==null){var chunks=size.split('|');$$('.tl_tablewizard textarea').each(function(el){el.setStyle('width',chunks[0]);el.setStyle('height',chunks[1])})}},tableWizardSetWidth:function(){var wrap=$('tl_tablewizard');if(!wrap)return;wrap.setStyle('width',Math.round(wrap.getParent('.tl_formbody_edit').getComputedSize().width*0.96))},moduleWizard:function(id){var table=$(id),tbody=table.getElement('tbody'),makeSortable=function(tbody){var rows=tbody.getChildren(),childs,i,j,select,input;for(i=0;i<rows.length;i++){childs=rows[i].getChildren();for(j=0;j<childs.length;j++){if(select=childs[j].getElement('select')){select.name=select.name.replace(/\[[0-9]+]/g,'['+i+']')}
if(input=childs[j].getElement('input[type="checkbox"]')){input.set('tabindex',-1);input.name=input.name.replace(/\[[0-9]+]/g,'['+i+']')}}}
new Sortables(tbody,{constrain:!0,opacity:0.6,handle:'.drag-handle',onComplete:function(){makeSortable(tbody)}})},addEventsTo=function(tr){var command,select,next,ntr,childs,cbx,i;tr.getElements('button').each(function(bt){if(bt.hasEvent('click'))return;command=bt.getProperty('data-command');switch(command){case 'copy':bt.addEvent('click',function(){Backend.getScrollOffset();ntr=new Element('tr');childs=tr.getChildren();for(i=0;i<childs.length;i++){next=childs[i].clone(!0).inject(ntr,'bottom');if(select=childs[i].getElement('select')){next.getElement('select').value=select.value}}
ntr.inject(tr,'after');ntr.getElement('.chzn-container').destroy();new Chosen(ntr.getElement('select.tl_select'));addEventsTo(ntr);makeSortable(tbody)});break;case 'delete':bt.addEvent('click',function(){Backend.getScrollOffset();if(tbody.getChildren().length>1){tr.destroy()}
makeSortable(tbody)});break;case 'enable':bt.addEvent('click',function(){Backend.getScrollOffset();cbx=bt.getNext('input[type="checkbox"]');if(cbx.checked){cbx.checked='';bt.getElement('img').src=Backend.themePath+'icons/invisible.svg'}else{cbx.checked='checked';bt.getElement('img').src=Backend.themePath+'icons/visible.svg'}
makeSortable(tbody)});break;case null:bt.addEvent('keydown',function(e){if(e.event.keyCode==38){e.preventDefault();if(ntr=tr.getPrevious('tr')){tr.inject(ntr,'before')}else{tr.inject(tbody,'bottom')}
bt.focus();makeSortable(tbody)}else if(e.event.keyCode==40){e.preventDefault();if(ntr=tr.getNext('tr')){tr.inject(ntr,'after')}else{tr.inject(tbody,'top')}
bt.focus();makeSortable(tbody)}});break}})};makeSortable(tbody);tbody.getChildren().each(function(tr){addEventsTo(tr)})},optionsWizard:function(id){var table=$(id),tbody=table.getElement('tbody'),makeSortable=function(tbody){var rows=tbody.getChildren(),childs,i,j,input;for(i=0;i<rows.length;i++){childs=rows[i].getChildren();for(j=0;j<childs.length;j++){if(input=childs[j].getFirst('input')){input.name=input.name.replace(/\[[0-9]+]/g,'['+i+']');if(input.type=='checkbox'){input.id=input.name.replace(/\[[0-9]+]/g,'').replace(/\[/g,'_').replace(/]/g,'')+'_'+i;input.getNext('label').set('for',input.id)}}}}
new Sortables(tbody,{constrain:!0,opacity:0.6,handle:'.drag-handle',onComplete:function(){makeSortable(tbody)}})},addEventsTo=function(tr){var command,input,next,ntr,childs,i;tr.getElements('button').each(function(bt){if(bt.hasEvent('click'))return;command=bt.getProperty('data-command');switch(command){case 'copy':bt.addEvent('click',function(){Backend.getScrollOffset();ntr=new Element('tr');childs=tr.getChildren();for(i=0;i<childs.length;i++){next=childs[i].clone(!0).inject(ntr,'bottom');if(input=childs[i].getFirst('input')){next.getFirst('input').value=input.value;if(input.type=='checkbox'){next.getFirst('input').checked=input.checked?'checked':''}}}
ntr.inject(tr,'after');addEventsTo(ntr);makeSortable(tbody)});break;case 'delete':bt.addEvent('click',function(){Backend.getScrollOffset();if(tbody.getChildren().length>1){tr.destroy()}
makeSortable(tbody)});break;case null:bt.addEvent('keydown',function(e){if(e.event.keyCode==38){e.preventDefault();if(ntr=tr.getPrevious('tr')){tr.inject(ntr,'before')}else{tr.inject(tbody,'bottom')}
bt.focus();makeSortable(tbody)}else if(e.event.keyCode==40){e.preventDefault();if(ntr=tr.getNext('tr')){tr.inject(ntr,'after')}else{tr.inject(tbody,'top')}
bt.focus();makeSortable(tbody)}});break}})};makeSortable(tbody);tbody.getChildren().each(function(tr){addEventsTo(tr)})},keyValueWizard:function(id){var table=$(id),tbody=table.getElement('tbody'),makeSortable=function(tbody){var rows=tbody.getChildren(),childs,i,j,input;for(i=0;i<rows.length;i++){childs=rows[i].getChildren();for(j=0;j<childs.length;j++){if(input=childs[j].getFirst('input')){input.name=input.name.replace(/\[[0-9]+]/g,'['+i+']')}}}
new Sortables(tbody,{constrain:!0,opacity:0.6,handle:'.drag-handle',onComplete:function(){makeSortable(tbody)}})},addEventsTo=function(tr){var command,input,next,ntr,childs,i;tr.getElements('button').each(function(bt){if(bt.hasEvent('click'))return;command=bt.getProperty('data-command');switch(command){case 'copy':bt.addEvent('click',function(){Backend.getScrollOffset();ntr=new Element('tr');childs=tr.getChildren();for(i=0;i<childs.length;i++){next=childs[i].clone(!0).inject(ntr,'bottom');if(input=childs[i].getFirst('input')){next.getFirst().value=input.value}}
ntr.inject(tr,'after');addEventsTo(ntr);makeSortable(tbody)});break;case 'delete':bt.addEvent('click',function(){Backend.getScrollOffset();if(tbody.getChildren().length>1){tr.destroy()}
makeSortable(tbody)});break;case null:bt.addEvent('keydown',function(e){if(e.event.keyCode==38){e.preventDefault();if(ntr=tr.getPrevious('tr')){tr.inject(ntr,'before')}else{tr.inject(tbody,'bottom')}
bt.focus();makeSortable(tbody)}else if(e.event.keyCode==40){e.preventDefault();if(ntr=tr.getNext('tr')){tr.inject(ntr,'after')}else{tr.inject(tbody,'top')}
bt.focus();makeSortable(tbody)}});break}})};makeSortable(tbody);tbody.getChildren().each(function(tr){addEventsTo(tr)})},checkboxWizard:function(id){var container=$(id).getElement('.sortable'),makeSortable=function(container){new Sortables(container,{constrain:!0,opacity:0.6,handle:'.drag-handle'})},addEventsTo=function(span){var nspan;span.getElements('button').each(function(bt){if(bt.hasEvent('click'))return;bt.addEvent('keydown',function(e){if(e.event.keyCode==38){e.preventDefault();if((nspan=span.getPrevious('span'))){span.inject(nspan,'before')}else{span.inject(container,'bottom')}
bt.focus()}else if(e.event.keyCode==40){e.preventDefault();if(nspan=span.getNext('span')){span.inject(nspan,'after')}else{span.inject(container,'top')}
bt.focus()}})})};makeSortable(container);container.getChildren().each(function(span){addEventsTo(span)})},metaWizard:function(el,ul){var opt=el.getParent('div').getElement('select');if(opt.value==''){return}
var li=$(ul).getLast('li').clone(),span=li.getElement('span'),img=span.getElement('img');li.setProperty('data-language',opt.value);span.set('text',opt.options[opt.selectedIndex].text+' ');img.inject(span,'bottom');li.getElements('input').each(function(inp){inp.value='';inp.name=inp.name.replace(/\[[a-z]{2}(_[A-Z]{2})?]/,'['+opt.value+']');var lbl=inp.getPrevious('label'),i=parseInt(lbl.get('for').replace(/ctrl_[^_]+_/,''));lbl.set('for',lbl.get('for').replace(i,i+1));inp.id=lbl.get('for')});li.className=(li.className=='even')?'odd':'even';li.inject($(ul),'bottom');el.getParent('div').getElement('input[type="button"]').setProperty('disabled',!0);opt.options[opt.selectedIndex].setProperty('disabled',!0);opt.value='';opt.fireEvent('liszt:updated')},metaDelete:function(el){var li=el.getParent('li'),opt=el.getParent('div').getElement('select');if(li.getPrevious()===null&&li.getNext()===null){li.getElements('input').each(function(input){input.value=''})}else{opt.getElement('option[value='+li.getProperty('data-language')+']').removeProperty('disabled');li.destroy();opt.fireEvent('liszt:updated')}},toggleAddLanguageButton:function(el){var inp=el.getParent('div').getElement('input[type="button"]');if(el.value!=''){inp.removeProperty('disabled')}else{inp.setProperty('disabled',!0)}},sectionWizard:function(id){var table=$(id),tbody=table.getElement('tbody'),makeSortable=function(tbody){var rows=tbody.getChildren(),childs,i,j;for(i=0;i<rows.length;i++){childs=rows[i].getChildren();for(j=0;j<childs.length;j++){childs[j].getElements('input').each(function(input){input.name=input.name.replace(/\[[0-9]+]/g,'['+i+']')});childs[j].getElements('select').each(function(select){select.name=select.name.replace(/\[[0-9]+]/g,'['+i+']')})}}
new Sortables(tbody,{constrain:!0,opacity:0.6,handle:'.drag-handle',onComplete:function(){makeSortable(tbody)}})},addEventsTo=function(tr){var command,next,ntr,childs,selects,nselects,i,j;tr.getElements('button').each(function(bt){if(bt.hasEvent('click'))return;command=bt.getProperty('data-command');switch(command){case 'copy':bt.addEvent('click',function(){Backend.getScrollOffset();ntr=new Element('tr');childs=tr.getChildren();for(i=0;i<childs.length;i++){next=childs[i].clone(!0).inject(ntr,'bottom');selects=childs[i].getElements('select');nselects=next.getElements('select');for(j=0;j<selects.length;j++){nselects[j].value=selects[j].value}}
ntr.inject(tr,'after');addEventsTo(ntr);makeSortable(tbody)});break;case 'delete':bt.addEvent('click',function(){Backend.getScrollOffset();if(tbody.getChildren().length>1){tr.destroy()}
makeSortable(tbody)});break;case null:bt.addEvent('keydown',function(e){if(e.event.keyCode==38){e.preventDefault();if(ntr=tr.getPrevious('tr')){tr.inject(ntr,'before')}else{tr.inject(tbody,'bottom')}
bt.focus();makeSortable(tbody)}else if(e.event.keyCode==40){e.preventDefault();if(ntr=tr.getNext('tr')){tr.inject(ntr,'after')}else{tr.inject(tbody,'top')}
bt.focus();makeSortable(tbody)}});break}})};makeSortable(tbody);tbody.getChildren().each(function(tr){addEventsTo(tr)})},updateModuleLink:function(el){var td=el.getParent('tr').getLast('td'),a=td.getElement('a.module_link');a.href=a.href.replace(/id=[0-9]+/,'id='+el.value);if(el.value>0){td.getElement('a.module_link').setStyle('display',null);td.getElement('img.module_image').setStyle('display','none')}else{td.getElement('a.module_link').setStyle('display','none');td.getElement('img.module_image').setStyle('display',null)}},enableImageSizeWidgets:function(){$$('.tl_image_size').each(function(el){var select=el.getElement('select'),widthInput=el.getChildren('input')[0],heightInput=el.getChildren('input')[1],update=function(){if(select.get('value')===''||select.get('value').toInt().toString()===select.get('value')){widthInput.readOnly=!0;heightInput.readOnly=!0;var dimensions=$(select.getSelected()[0]).get('text');dimensions=dimensions.split('(').length>1?dimensions.split('(').getLast().split(')')[0].split('x'):['',''];widthInput.set('value','').set('placeholder',dimensions[0]*1||'');heightInput.set('value','').set('placeholder',dimensions[1]*1||'')}else{widthInput.set('placeholder','');heightInput.set('placeholder','');widthInput.readOnly=!1;heightInput.readOnly=!1}};update();select.addEvent('change',update);select.addEvent('keyup',update)})},enableToggleSelect:function(){var container=$('tl_select'),shiftToggle=function(el){thisIndex=checkboxes.indexOf(el);startIndex=checkboxes.indexOf(start);from=Math.min(thisIndex,startIndex);to=Math.max(thisIndex,startIndex);status=!!checkboxes[startIndex].checked;for(from;from<=to;from++){checkboxes[from].checked=status}},clickEvent=function(e){var input=this.getElement('input[type="checkbox"],input[type="radio"]');if(!input||input.get('disabled')){return}
if(input.type=='radio'){if(!input.checked){input.checked='checked'}
return}
if(e.shift&&start){shiftToggle(input)}else{input.checked=input.checked?'':'checked';if(input.get('onclick')=='Backend.toggleCheckboxes(this)'){Backend.toggleCheckboxes(input)}}
start=input},checkboxes=[],start,thisIndex,startIndex,status,from,to;if(container){checkboxes=container.getElements('input[type="checkbox"]')}
$$('.toggle_select').each(function(el){var boundEvent=el.retrieve('boundEvent');if(boundEvent){el.removeEvent('click',boundEvent)}
el.getElements('label,input[type="checkbox"],input[type="radio"]').each(function(i){i.addEvent('click',function(e){e.stopPropagation()})});boundEvent=clickEvent.bind(el);el.addEvent('click',boundEvent);el.store('boundEvent',boundEvent)});checkboxes.each(function(el){el.addEvent('click',function(e){if(e.shift&&start){shiftToggle(this)}
start=this})})},autoFocusFirstInputField:function(){var edit=document.id('main').getElement('.tl_formbody_edit');if(!edit)return;var inputs=edit.getElements('input, textarea').filter(function(item){return!item.get('disabled')&&item.isVisible()&&item.get('type')!=='checkbox'&&item.get('type')!=='radio'&&item.get('type')!=='submit'&&item.get('type')!=='image'});if(inputs[0])inputs[0].focus()},editPreviewWizard:function(el){el=$(el);var imageElement=el.getElement('img'),inputElements={},isDrawing=!1,originalWidth=el.get('data-original-width'),originalHeight=el.get('data-original-height'),partElement,startPos,getScale=function(){return imageElement.getComputedSize().width/originalWidth},updateImage=function(){var scale=getScale(),imageSize=imageElement.getComputedSize();partElement.setStyles({top:imageSize.computedTop+(inputElements.y.get('value')*scale).round()+'px',left:imageSize.computedLeft+(inputElements.x.get('value')*scale).round()+'px',width:(inputElements.width.get('value')*scale).round()+'px',height:(inputElements.height.get('value')*scale).round()+'px'});if(!inputElements.width.get('value').toInt()||!inputElements.height.get('value').toInt()){partElement.setStyle('display','none')}else{partElement.setStyle('display',null)}},updateValues=function(){var scale=getScale(),styles=partElement.getStyles('top','left','width','height'),imageSize=imageElement.getComputedSize(),values={x:Math.max(0,Math.min(originalWidth,(styles.left.toFloat()-imageSize.computedLeft)/scale)).round(),y:Math.max(0,Math.min(originalHeight,(styles.top.toFloat()-imageSize.computedTop)/scale)).round()};values.width=Math.min(originalWidth-values.x,styles.width.toFloat()/scale).round();values.height=Math.min(originalHeight-values.y,styles.height.toFloat()/scale).round();if(!values.width||!values.height){values.x=values.y=values.width=values.height='';partElement.setStyle('display','none')}else{partElement.setStyle('display',null)}
Object.each(values,function(value,key){inputElements[key].set('value',value)})},start=function(event){event.preventDefault();if(isDrawing){return}
isDrawing=!0;startPos={x:event.page.x-el.getPosition().x-imageElement.getComputedSize().computedLeft,y:event.page.y-el.getPosition().y-imageElement.getComputedSize().computedTop};move(event)},move=function(event){if(!isDrawing){return}
event.preventDefault();var imageSize=imageElement.getComputedSize();var rect={x:[Math.max(0,Math.min(imageSize.width,startPos.x)),Math.max(0,Math.min(imageSize.width,event.page.x-el.getPosition().x-imageSize.computedLeft))],y:[Math.max(0,Math.min(imageSize.height,startPos.y)),Math.max(0,Math.min(imageSize.height,event.page.y-el.getPosition().y-imageSize.computedTop))]};partElement.setStyles({top:Math.min(rect.y[0],rect.y[1])+imageSize.computedTop+'px',left:Math.min(rect.x[0],rect.x[1])+imageSize.computedLeft+'px',width:Math.abs(rect.x[0]-rect.x[1])+'px',height:Math.abs(rect.y[0]-rect.y[1])+'px'});updateValues()},stop=function(event){move(event);isDrawing=!1},init=function(){el.getParent('.tl_tbox,.tl_box').getElements('input[name^="importantPart"]').each(function(input){['x','y','width','height'].each(function(key){if(input.get('name').substr(13,key.length)===key.capitalize()){inputElements[key]=input=$(input)}})});if(Object.getLength(inputElements)!==4){return}
Object.each(inputElements,function(input){input.getParent().setStyle('display','none')});el.addClass('tl_edit_preview_enabled');partElement=new Element('div',{'class':'tl_edit_preview_important_part'}).inject(el);updateImage();imageElement.addEvent('load',updateImage);el.addEvents({mousedown:start,touchstart:start});$(document.documentElement).addEvents({mousemove:move,touchmove:move,mouseup:stop,touchend:stop,touchcancel:stop,resize:updateImage})};window.addEvent('domready',init)},enableFileTreeUpload:function(wrap,options){wrap=$(wrap);var fallbackUrl=options.url,dzElement=new Element('div',{'class':'dropzone dropzone-filetree',html:'<span class="dropzone-previews"></span>'}).inject(wrap,'top'),currentHover,currentHoverTime;options.previewsContainer=dzElement.getElement('.dropzone-previews');options.clickable=!1;var dz=new Dropzone(wrap,options);dz.on('queuecomplete',function(){window.location.reload()});dz.on('dragover',function(event){if(!event.dataTransfer||!event.dataTransfer.types||event.dataTransfer.types.indexOf('Files')===-1){return}
wrap.getElements('.tl_folder_dropping').removeClass('tl_folder_dropping');var target=event.target&&$(event.target);if(target){var folder=target.match('.tl_folder')?target:target.getParent('.tl_folder');if(!folder){folder=target.getParent('.parent');folder=folder&&folder.getPrevious('.tl_folder')}
if(folder){var link=folder.getElement('img[src$="/icons/new.svg"]');link=link&&link.getParent('a')}}
if(link&&link.href){dz.options.url=''+link.href;folder.addClass('tl_folder_dropping');if(currentHover!==folder){currentHover=folder;currentHoverTime=new Date().getTime();var expandLink=folder.getElement('img[src$="/icons/folPlus.svg"]');expandLink=expandLink&&expandLink.getParent('a');if(expandLink){setTimeout(function(){if(currentHover===folder&&currentHoverTime+900<new Date().getTime()){var event=document.createEvent('HTMLEvents');event.initEvent('click',!0,!0);expandLink.dispatchEvent(event);currentHover=undefined;currentHoverTime=undefined}},1000)}}}else{dz.options.url=fallbackUrl;currentHover=undefined;currentHoverTime=undefined}});dz.on('drop',function(event){if(!event.dataTransfer||!event.dataTransfer.types||event.dataTransfer.types.indexOf('Files')===-1){return}
dzElement.addClass('dropzone-filetree-enabled');Backend.getScrollOffset()});dz.on('dragleave',function(){wrap.getElements('.tl_folder_dropping').removeClass('tl_folder_dropping');currentHover=undefined;currentHoverTime=undefined})},dcTableDragAndDrop:(function(){var expandTimer=!1;function _highlightRow(status,destinationItem){var cssClassName='visualize-droparea';var action='remove';if(status==='show'){action='add'}
return destinationItem[action+'Class'](cssClassName)}
function _isRightClick(event){return event.rightClick||event.control}
function _cloneDragElement(currentDragItem){var wrapper=new Element('div.currrent-drag-clone',{styles:currentDragItem.getCoordinates()})
var clone=currentDragItem.getElement('.tl_left').clone()
return wrapper.adopt(clone).inject(document.body)}
function _isParent(item){return item.hasClass('is-parent')}
function _childsVisible(tlLeftFromParentItem){return tlLeftFromParentItem.getElement('.expandable img[src$="/icons/folMinus.svg"]')!==null}
function _autoExpandChilds(listingContainer,droppableItems,listDragAndDropInstance,expandIconItem){var timer=1000;expandTimer=setTimeout(function(){var event=document.createEvent('HTMLEvents');event.initEvent('click',!0,!0);expandIconItem.dispatchEvent(event);expandTimer=!1;window.addEvent('ajax_change',function onAjax(){if(listDragAndDropInstance&&listDragAndDropInstance.droppables){listDragAndDropInstance.droppables=listingContainer.getElements(droppableItems)}
window.removeEvent('ajax_change',onAjax)})},timer)}
function _getRowInfoData(curRowItem){return curRowItem.getElement('.tl_left')}
function _generateSaveUrl(url,mode,id,pid){return url.replace(/:mode/,mode).replace(/:id/,id).replace(/:pid/,pid)}
function _getCurrentValidDragItem(item){return(item.hasClass('tl_file')||item.hasClass('tl_folder'))?item:item.getParent('.tl_file,.tl_folder')}
function _initDragAndDrop(event,options){event.stop();var url=options.url;var droppableItems=options.droppables;var listingContainer=options.listingContainer;var currentDragItem=_getCurrentValidDragItem(event.target);if((!currentDragItem||event.target.match('a')||event.target.getParent('a'))||_isRightClick(event)){return}
var dragabbleClone=_cloneDragElement(currentDragItem);var currentDragItemId=currentDragItem.get('data-id');var pasteMode=1;var listDragAndDropInstance=new Drag.Move(dragabbleClone,{droppables:listingContainer.getElements(droppableItems),onDrop:function(draggedItem,destinationItem){draggedItem.destroy();if(destinationItem===null){return}
_highlightRow('hide',destinationItem);var pasteId=destinationItem.get('data-id');if(_isParent(destinationItem)){pasteMode=2}
window.location.href=_generateSaveUrl(url,pasteMode,currentDragItemId,pasteId);AjaxRequest.displayBox(Contao.lang.saving)},onEnter:function(draggedItem,destinationItem){_highlightRow('show',destinationItem);var _tlLeft=_getRowInfoData(destinationItem);if(_isParent(destinationItem)){var isExpanded=_childsVisible(_tlLeft);if(!isExpanded){_autoExpandChilds(listingContainer,droppableItems,listDragAndDropInstance,_tlLeft.getElement('.expandable img[src$="/icons/folPlus.svg"]'))}}},onLeave:function(draggedItem,destinationItem){_highlightRow('hide',destinationItem);if(expandTimer!==!1){clearInterval(expandTimer);expandTimer=!1}},onCancel:function(draggedItem,destinationItem){draggedItem.destroy()}})
listDragAndDropInstance.start(event)}
return{init:function(dragabbleItems,options){if(!'listingContainer' in options||!'url' in options||!'droppables' in options){console.error(new Error('Argument two misses required options! Required are listingContainer, url and droppables.'));return}
options.listingContainer.addClass('js-is-dragdrop-ready');dragabbleItems.addEvent('mousedown',function(event){_initDragAndDrop(event,options)})}}})()};document.addEvent('mousedown',function(event){Backend.getMousePosition(event)});window.addEvent('domready',function(){$(document.body).addClass('js');if(Browser.Features.Touch){$(document.body).addClass('touch')}
Backend.collapsePalettes();Backend.addInteractiveHelp();Backend.tableWizardSetWidth();Backend.enableImageSizeWidgets();Backend.enableToggleSelect();Backend.autoFocusFirstInputField();if(Elements.chosen!=undefined){$$('select.tl_chosen').chosen()}
$$('textarea.monospace').each(function(el){Backend.toggleWrap(el)})});window.addEvent('resize',function(){Backend.tableWizardSetWidth()});window.addEvent('load',function(){Backend.limitPreviewHeight()});window.addEvent('ajax_change',function(){Backend.addInteractiveHelp();Backend.enableImageSizeWidgets();Backend.enableToggleSelect();if(Elements.chosen!=undefined){$$('select.tl_chosen').filter(function(el){return el.getStyle('display')!='none'}).chosen()}})