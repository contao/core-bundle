services:
    contao.listener.add_to_search_index:
        class: Contao\CoreBundle\EventListener\AddToSearchIndexListener
        tags:
            - { name: kernel.event_listener, event: kernel.terminate, method: onKernelTerminate }

    # Attention: the priority for this listener must be higher than any other listener that uses legacy Contao code
    # Must be lower than route_listener (default: 32)
    contao.listener.boostrap_legacy:
        class: Contao\CoreBundle\EventListener\BootstrapLegacyListener
        arguments:
            - "@router"
            - "%kernel.root_dir%"
        tags:
            - { name: kernel.event_listener, event: kernel.request, method: onBootLegacyForRequest, priority: 30 }
            - { name: kernel.event_listener, event: console.command, method: onBootLegacyForConsole }

    contao.listener.container_scope:
        class: Contao\CoreBundle\EventListener\ContainerScopeListener
        arguments:
            - "@service_container"
        tags:
            - { name: kernel.event_listener, event: kernel.controller, method: onKernelController, priority: 254 }
            - { name: kernel.event_listener, event: kernel.finish_request, method: onKernelFinishRequest, priority: -254 }

    contao.listener.handle_exception:
        class: Contao\CoreBundle\EventListener\ExceptionListener
        tags:
            - { name: kernel.event_listener, event: kernel.exception, method: onGetResponseForException, priority: 200 }

    contao.listener.output_from_cache:
        class: Contao\CoreBundle\EventListener\OutputFromCacheListener
        tags:
            # priority is temporarily lower than contao.listener.boostrap_legacy as until not depending on legacy code
            # anymore.
            - { name: kernel.event_listener, event: kernel.request, method: onKernelRequest, priority: 26 }

    contao.listener.toggle_view:
        class: Contao\CoreBundle\EventListener\ToggleViewListener
        tags:
            # priority is temporarily lower than contao.listener.boostrap_legacy as until not depending on legacy code
            # anymore.
            - { name: kernel.event_listener, event: kernel.request, method: onKernelRequest, priority: 28 }

    contao.routing.backend_loader:
        parent: routing.bundle_resource_loader
        arguments:
            - "@@ContaoCoreBundle/Resources/config/routing.yml"
        tags:
            - { name: routing.bundle_loader, priority: 200 }

    contao.routing.dev_loader:
        parent: routing.bundle_resource_loader
        arguments:
            - "@@ContaoCoreBundle/Resources/config/routing_dev.yml"
            - ["dev", "test"]
        tags:
            - { name: routing.bundle_loader }

    contao.routing.frontend_loader:
        class: Contao\CoreBundle\Routing\FrontendLoader
        arguments:
            - "%add_language_to_url%"
            - "%url_suffix%"
        tags:
            - { name: routing.bundle_loader, priority: -250 }

    contao.security.authenticator:
        class: Contao\CoreBundle\Security\ContaoAuthenticator
        arguments:
            - "@contao.security.user_provider"

    contao.security.user_provider:
        class: Contao\CoreBundle\Security\User\ContaoUserProvider

    data_collector.contao:
        class: Contao\CoreBundle\DataCollector\ContaoDataCollector
        tags:
            - { name: data_collector, template: "ContaoCoreBundle:Collector:contao", id: "contao" }
